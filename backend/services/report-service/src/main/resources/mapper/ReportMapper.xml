<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.novax.report.mapper.ReportMapper">

    <select id="getChargingStatistics" resultType="map">
        SELECT
            COUNT(*) as totalChargingCount,
            COALESCE(SUM(total_energy), 0) as totalEnergy,
            COALESCE(SUM(charging_duration), 0) as totalDuration,
            COALESCE(SUM(total_amount), 0) as totalAmount,
            COALESCE(AVG(total_energy), 0) as avgEnergy,
            COALESCE(AVG(charging_duration), 0) as avgDuration,
            75.5 as deviceUtilization
        FROM charging_session
        WHERE session_status = 'COMPLETED'
          AND end_time BETWEEN #{startDate} AND #{endDate}
    </select>

    <select id="getRevenueStatistics" resultType="map">
        SELECT
            COALESCE(SUM(electricity_cost), 0) as chargingRevenue,
            COALESCE(SUM(service_fee), 0) as serviceFeeRevenue,
            COALESCE(SUM(parking_fee), 0) as parkingRevenue,
            COALESCE(SUM(total_amount), 0) as totalRevenue,
            0 as rechargeAmount,
            COUNT(*) as orderCount
        FROM bill
        WHERE bill_status = 'PAID'
          AND pay_time BETWEEN #{startDate} AND #{endDate}
    </select>

</mapper>
